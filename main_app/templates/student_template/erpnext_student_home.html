{% extends 'main_app/base.html' %}
{% load static %}
{% block page_title %}Student Dashboard{% endblock page_title %}
{% block content %}
<section class="content aegis-section">
    <!-- Student Portal Header -->
    <div class="portal-header student-portal mb-4 animate-fade-in">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1><i class="fas fa-user-graduate"></i> Student Dashboard</h1>
                <p>Track your attendance, grades, and academic progress</p>
            </div>
            <div class="text-end">
                <div class="badge bg-white text-dark fs-6 px-3 py-2">
                    <i class="fas fa-calendar"></i> {% now "M d, Y" %}
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="stat-grid animate-slide-up">
        <div class="stat-box">
            <div class="stat-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-content">
                <h3>{{total_attendance}}</h3>
                <p>Total Attendance</p>
            </div>
        </div>
        
        <div class="stat-box">
            <div class="stat-icon">
                <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-content">
                <h3>{{percent_present}}<span style="font-size: 1.2rem;">%</span></h3>
                <p>Present Percentage</p>
            </div>
        </div>
        
        <div class="stat-box">
            <div class="stat-icon">
                <i class="fas fa-calendar-minus"></i>
            </div>
            <div class="stat-content">
                <h3>{{percent_absent}}<span style="font-size: 1.2rem;">%</span></h3>
                <p>Absent Percentage</p>
            </div>
        </div>
        
        <div class="stat-box">
            <div class="stat-icon">
                <i class="fas fa-book"></i>
            </div>
            <div class="stat-content">
                <h3>{{total_subject}}</h3>
                <p>Total Subjects</p>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="row mt-4">
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card">
                <div class="card-header bg-transparent border-0">
                    <h4 class="mb-0">
                        <i class="fas fa-chart-pie me-2" style="color: #8e2de2;"></i>
                        Attendance Overview
                    </h4>
                </div>
                <div class="card-body">
                    <canvas id="attendanceData" style="height: 300px;"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card">
                <div class="card-header bg-transparent border-0">
                    <h4 class="mb-0">
                        <i class="fas fa-chart-bar me-2" style="color: #8e2de2;"></i>
                        Subject-wise Attendance
                    </h4>
                </div>
                <div class="card-body">
                    <canvas id="attendanceStatistics" style="height: 300px;"></canvas>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock content %}

{% block custom_js %}
<script>
$(document).ready(function(){
    // Chart.js Configuration
    Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif';
    Chart.defaults.color = '#262626';

    // Student Portal Colors
    var colors = {
        primary: '#8e2de2',
        secondary: '#4a00e0',
        accent: '#a855f7',
        success: '#28a745',
        danger: '#dc3545',
        warning: '#ffc107',
        info: '#17a2b8'
    };

    // Dataset
    var subjects = {{data_name|safe}};
    var data_present = {{data_present}};
    var data_absent = {{data_absent}};

    // Attendance Overview - Donut Chart
    var attendanceDataCanvas = $('#attendanceData').get(0).getContext('2d');
    var donutData = {
        labels: ['Present', 'Absent'],
        datasets: [{
            data: [{{percent_present}}, {{percent_absent}}],
            backgroundColor: [colors.success, colors.danger],
            borderWidth: 3,
            borderColor: '#fff',
            cutout: '65%'
        }]
    };
    var donutOptions = {
        maintainAspectRatio: false,
        responsive: true,
        plugins: {
            legend: {
                display: true,
                position: 'bottom',
                labels: {
                    usePointStyle: true,
                    padding: 20,
                    font: {
                        size: 13,
                        weight: '500'
                    }
                }
            }
        }
    };
    var attendanceData = new Chart(attendanceDataCanvas, {
        type: 'doughnut',
        data: donutData,
        options: donutOptions      
    });

    // Subject-wise Attendance - Bar Chart
    var areaChartData = {
        labels: subjects,
        datasets: [
            {
                label: 'Present',
                data: data_present,
                backgroundColor: colors.primary,
                borderRadius: 6,
                borderSkipped: false
            },
            {
                label: 'Absent',
                data: data_absent,
                backgroundColor: colors.danger,
                borderRadius: 6,
                borderSkipped: false
            }
        ]
    };

    var barChartCanvas = $('#attendanceStatistics').get(0).getContext('2d');
    var barChartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: true,
                position: 'top',
                labels: {
                    usePointStyle: true,
                    padding: 20,
                    font: {
                        size: 13,
                        weight: '500'
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: '#e5e7eb',
                    drawBorder: false
                }
            },
            x: {
                grid: {
                    display: false
                }
            }
        }
    };

    var barChart = new Chart(barChartCanvas, {
        type: 'bar',
        data: areaChartData,
        options: barChartOptions
    });
});
</script>
{% endblock custom_js %}
